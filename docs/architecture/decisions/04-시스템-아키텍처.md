# 시스템 아키텍처

Date: 2025-02-13

## 상태

일부 적용  
(참고 : [# MSA 시스템 아키텍처.md](04-시스템-아키텍처.md))

## 요약

!["System Architecture"](../src/04-시스템-아키텍처-요약.png)

<br/>

- **AWS EC2 인스턴스 내에서 Docker 기반**으로 프론트엔드(Next.js), 백엔드(Spring Boot), 데이터베이스(MariaDB)를 **각각 컨테이너로 분리하여 실행** 하고 있습니다.
- **Nginx**는 리버스 프록시로서 요청을 각 서비스로 분기하며, 외부 서비스로는 **Google OAuth**와 **AWS SES**를 연동하여 인증 및 메일 전송을 처리합니다.

  <br/>
  <br/>

## 맥락

초기 개발 단계에서는 **빠른 배포와 구조 검증이 중요한 상황**이었습니다.  
이에 따라 **하나의 EC2 인스턴스에서 모든 서비스를 컨테이너 단위로 구동하는 구조를 선택**하였으며, 다음과 같은 설계 방향을 따랐습니다.

### 프론트엔드/백엔드 분리 설계

프론트엔드는 사용자 경험과 렌더링을 담당하며, 백엔드는 인증·피드·상태 관리를 담당합니다.  
 이를 통해 UI와 비즈니스 로직을 독립적으로 개발·배포할 수 있도록 하였습니다.

---

### Docker 기반 모놀리식 실행

Docker Compose를 통해 동일한 환경에서 전체 서비스를 실행 가능하게 구성하였으며, 운영 효율성과 테스트 일관성을 확보하였습니다.

---

### EC2 단일 구성 선택 배경

초기 운영 비용 절감과 단일 노드 운영의 간편함을 우선 고려하였고,  
 추후에는 AWS의 S3, RDS, ALB, ECS 등으로 확장할 수 있도록 유연한 구조로 설계하였습니다.

  <br/>
  <br/>

## 결정

!["System Architecture"](../src/04-시스템-아키텍처.png)

### Backend (Spring Boot)

- **REST API 제공 및 비즈니스 로직 처리**  
  피드 작성, 댓글, 좋아요 등의 기능을 API 형태로 제공합니다.

- **OAuth2 기반 인증 및 JWT 발급**  
  Google OAuth를 통해 사용자 인증을 위임받고, 자체 JWT를 발급하여 사용자 식별에 활용합니다.

- **계정 상태 이력 및 탈퇴 유예 관리**  
  탈퇴 요청 시 계정을 비활성화하고, 일정 유예 기간 후 자동 삭제 처리 로직을 관리합니다.

<br/>

---

<br/>

### Frontend (Next.js)

- **CSR/SSR 혼합 렌더링**  
  초기 페이지는 SSR로 제공하고, 이후 동작은 CSR 기반으로 처리하여 사용자 경험을 향상시킵니다.

- **전역 상태 관리 및 데이터 시각화**  
  Context API 기반으로 로그인, 피드, 닉네임 등의 상태를 관리하고, API 데이터를 가공하여 UI에 출력합니다.

<br/>

---

<br/>

### Database (MariaDB)

- **도메인 데이터 영속화 및 이력 관리**  
  사용자, 피드, 좋아요, 댓글 등의 엔티티를 안정적으로 저장하며, 시간 기반 상태 이력을 추적합니다.

- **인덱스를 활용한 성능 최적화**  
  복합 인덱스를 통해 무한 스크롤 기반의 피드 조회 성능을 개선하였습니다.

<br/>

---

<br/>

### Load Balancer (Nginx)

- **도메인 기반 요청 라우팅**  
  `/api` 요청은 백엔드로, 정적 요청은 프론트엔드로 전달합니다.

- **HTTPS 적용 및 보안 설정**  
  모든 요청을 HTTPS로 리디렉션하여 보안성을 확보합니다.  
  HttpOnly 쿠키 설정 등을 통해 보안 수준을 강화하였습니다.

<br/>

---

<br/>

### 외부 서비스 연동

- **Google OAuth**: 인증 코드와 사용자 정보 수신
- **AWS SES**: 탈퇴 인증 메일 발송 및 실패 대응 자동화

  <br/>
  <br/>

## 결과

단일 EC2 인스턴스 기반의 구조는 개발 초기에는 효율적이었으나, 다음과 같은 제한점이 있었습니다.

### ① EC2 단일 구성의 안정성 문제

- 부분 장애가 전체 서비스 중단으로 이어질 수 있음

---

### ② DB 백업 및 복구 전략 부족

- 장애 발생 시 데이터 손실 가능성
- `systemd` 및 `Docker restart` 정책을 활용해 일부 보완

---

### ③ SSR의 실효성 재검토

- 대부분의 페이지는 CSR로 충분하며, SSR 적용 범위를 조정할 필요성 발견
- 점진적으로 아래와 같은 개선 방향을 고려하고 있습니다.
  | 단계 | 개선 사항 | 기대 효과 |
  | :---: | :-------------------------------: | :--------------------------------------------: |
  | 1단계 | DB 분리 : aws RDS + EBS | 데이터 안정성 확보 및 백업/복구 기능 강화 |
  | 2단계 | 프론트엔드 분리 : S3 + CloudFront | 서버 부하 감소, 프론트엔드 독립 배포 구조 확보 |
  | 3단계 | ALB 추가 + Auto Scaling | 트래픽 분산 처리 및 시스템 유연성 향상 |
  | 4단계 | ECS 또는 EKS로 컨테이너 관리 전환 | 무중단 배포 및 자동 스케일링 환경 구축 |
