# `Access Token`의 쿠키 기반 방식으로 전환

Date: 2025-08-16  
Status: Accepted

## 맥락

#### 문제점

- 기존 인증 방식은 액세스 토큰을 브라우저의 `localStorage`에 저장했습니다.
- 이 방식은 자바스크립트를 통해 토큰에 쉽게 접근할 수 있어, XSS(Cross-Site Scripting) 공격에 취약했습니다.

#### 비일관성

- 리프레시 토큰은 이미 HttpOnly 쿠키를 사용하고 있었으나, 액세스 토큰은 그렇지 않아 관리 방식이 일관되지 않았습니다.
- 이로 인해 보안 수준이 낮고 프론트엔드 코드의 복잡성이 증가했습니다.

#### 목표

- XSS 공격으로부터 인증 토큰을 안전하게 보호하고, 인증 처리 로직을 단순화하며, 최신 웹 보안 표준에 부합하는 일관된 인증 아키텍처를 구축합니다.

<br/>

## 결정

### **백엔드**

- **쿠키 발급 방식 변경**:  
  - `OAuth2SuccessHandler`와 토큰 재발급 API(`TokenApiController`)를 수정하여 액세스 토큰도 HttpOnly + Secure 속성이 적용된 쿠키로 발급하도록 변경했습니다.

- **Path 최적화**:

  - 리프레시 토큰 쿠키의 Path를 `/api/token`으로 한정하여 불필요한 요청에서 전송되지 않도록 보안을 강화했습니다.

- **보안 설정 강화**:
  - Spring Security를 단일 `SecurityFilterChain`으로 통합하고,  
    CORS Preflight 요청(OPTIONS)을 허용하여 `application/json` 타입 요청이 정상 처리되도록 수정했습니다.

### **프론트엔드**

- **httpRequest 모듈 리팩토링**
  - `localStorage`에서 토큰을 읽고 Authorization 헤더를 추가하던 로직을 제거했습니다.
  - 모든 요청에 `credentials: 'include'` 옵션을 적용해 브라우저가 자동으로 HttpOnly 쿠키를 포함하도록 변경했습니다.


<br/>

## 결과

- **보안 강화**: HttpOnly 쿠키를 전면 도입하여 XSS 기반 토큰 탈취 위협을 차단했습니다.
- **코드 단순화 및 안정성 향상**: 프론트엔드는 토큰을 직접 관리하지 않고, 인증 처리를 브라우저와 백엔드에 위임하여 코드가 단순해지고 안정성이 높아졌습니다.
- **아키텍처 표준화**: 인증 및 토큰 관리 방식이 최신 웹 보안 권장 사항에 부합하도록 개선되어, 유지보수성과 확장성이 크게 향상되었습니다.
