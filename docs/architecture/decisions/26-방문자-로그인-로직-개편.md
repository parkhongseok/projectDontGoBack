# 방문자 로그인 로직 개편

Date: 2025-08-16  
Status: Accepted

## 맥락

기존 방문자 기능은 만료 기간이 정해진 JWT를 서버에 하드코딩하고, '둘러보기' 클릭 시 해당 토큰을 `localStorage`에 저장하여 사용했습니다.

이 방식은 다음과 같은 문제를 가졌습니다.

- **보안 취약성**: 토큰이 `localStorage`에 저장되어 XSS 공격에 노출
- **유지보수 문제**: 토큰 만료 시 수동 교체 필요, 서버 재시작 시 비정상 동작 발생

또한 전체 인증 체계를 HttpOnly 쿠키 기반으로 전환함에 따라, 방문자 기능 역시 이에 맞게 개선할 필요가 있었습니다.

<br/>

## 결정

① **전용 API 엔드포인트**

- `POST /api/guest`를 방문자 로그인 전용 API로 구현하고, 인증이 필요 없는 공개 경로로 설정했습니다.

② **Find or Create 로직**

- API 호출 시 DB에서 `GUEST` 역할 계정을 조회
- 계정이 없을 경우 자동 생성 후 저장

③ **일관된 쿠키 발급**

- 일반 사용자와 동일하게 액세스 토큰 + 리프레시 토큰을 생성하여 HttpOnly 쿠키로 발급

④ **프론트엔드 연동**

- 로그인 페이지의 '둘러보기' 버튼이 `POST /api/guest`를 호출하도록 수정
- 요청 성공 시 별도의 토큰 처리 없이 메인 페이지로 이동

<br/>

## 결과

- **보안 및 안정성 강화**: 하드코딩된 토큰 제거, API 호출마다 유효한 토큰 발급
- **아키텍처 일관성 확보**: 방문자 로그인 흐름이 일반 사용자 인증과 동일한 HttpOnly 쿠키 구조로 통일
- **사용자 경험 향상**: '둘러보기' 버튼 클릭만으로 서비스 체험이 가능, 중단 없는 UX 제공
